#!/bin/sh
# Copyright (C) 2012-2015 OpenWrt.org

move_config() {
	local partdev

	. /lib/upgrade/common.sh

	if export_bootdevice && export_partdevice partdev $((1-BOOTDEV_MINOR)); then
		mkdir /boot
		if mount -t vfat -o rw,noatime "/dev/$partdev" /boot; then
			if [ -f /boot/sysupgrade.tgz ]; then
				mount /boot -o remount,rw,noatime
				mv -f /boot/sysupgrade.tgz /
			fi
			mount /boot -o remount,ro,noatime
			mount --bind /boot/boot /boot
		fi
	fi
}

boot_hook_add preinit_mount_root move_config

