From 0875d9917bec369b1a350d547decd5f424296fc6 Mon Sep 17 00:00:00 2001
From: fengmushu <fengmushu@gmail.com>
Date: Mon, 27 Aug 2018 13:02:04 +0800
Subject: [PATCH 2/2] fixup dts for h6v2 mmc bit-width

---
 .../dts/allwinner/sun50i-h6-tempe-a55.dts     |  10 +-
 .../dts/allwinner/sun50i-h6-tempe-h6v2.dts    |   1 +
 arch/arm64/boot/dts/allwinner/sun50i-h6.dtsi  | 115 +-----------------
 3 files changed, 15 insertions(+), 111 deletions(-)

diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-a55.dts b/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-a55.dts
index 58aac9859..99deddc87 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-a55.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-a55.dts
@@ -94,7 +94,9 @@
 
 	wifi_pwrseq: wifi_pwrseq {
 		compatible = "mmc-pwrseq-simple";
-		reset-gpios = <&r_pio 1 3 GPIO_ACTIVE_LOW>; /* PM3 */
+		reset-gpios = <&r_pio 1 2 GPIO_ACTIVE_LOW>,
+						<&r_pio 1 3 GPIO_ACTIVE_LOW>,
+						<&r_pio 1 4 GPIO_ACTIVE_LOW>; /* PM:2,3,4 */
 		post-power-on-delay-ms = <50>;
 	};
 
@@ -363,6 +365,12 @@
 	status = "okay";
 };
 
+&uart1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&uart1_pg_pins>;
+	status = "okay";
+};
+
 &ohci0 {
 	status = "okay";
 };
diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-h6v2.dts b/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-h6v2.dts
index 07c120c21..1da5d9e42 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-h6v2.dts
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h6-tempe-h6v2.dts
@@ -122,6 +122,7 @@
 	pinctrl-0 = <&mmc2_pins>;
 	vmmc-supply = <&reg_aldo3>;
 	vqmmc-supply = <&reg_bldo2>;
+	bus-width = <8>;
 	non-removable;
 	cap-mmc-hw-reset;
 	status = "okay";
diff --git a/arch/arm64/boot/dts/allwinner/sun50i-h6.dtsi b/arch/arm64/boot/dts/allwinner/sun50i-h6.dtsi
index bf7636f27..f6966d874 100644
--- a/arch/arm64/boot/dts/allwinner/sun50i-h6.dtsi
+++ b/arch/arm64/boot/dts/allwinner/sun50i-h6.dtsi
@@ -252,6 +252,11 @@
 				function = "uart0";
 			};
 
+			uart1_pg_pins: uart1-pg {
+				pins = "PG6", "PG7", "PG8", "PG9";
+				function = "uart1";
+			};
+
 			twi0_pins: twi0-pd {
 				pins = "PD25", "PD26";
 				function = "i2c0";
@@ -666,116 +671,6 @@
 			status = "okay";
 		};
 
-		// pwm: pwm@0300a000 {
-		// 	compatible = "allwinner,sunxi-pwm";
-		// 	reg = <0x0300a000 0x3c>;
-		// 	clocks = <&ccu CLK_BUS_PWM>;
-		// 	resets = <&ccu RST_BUS_PWM>;
-		// 	pwm-base = <0x0>;
-		// 	pwm-number = <2>;
-		// 	pwms = <&pwm0>, <&pwm1>;
-		// };
-
-		// pwm0: pwm0@0300a000 {
-		// 	compatible = "allwinner,sunxi-pwm0";
-		// 	pinctrl-names = "default", "sleep";
-		// 	pinctrl-0 = <&pwm0_pins>;
-		// 	pinctrl-1 = <&pwm0_pins_gpio>;
-		// 	reg_base = <0x0300a000>;
-		// 	reg_busy_offset = <0x00>;
-		// 	reg_busy_shift = <28>;
-		// 	reg_enable_offset = <0x00>;
-		// 	reg_enable_shift = <4>;
-		// 	reg_clk_gating_offset = <0x00>;
-		// 	reg_clk_gating_shift = <6>;
-		// 	reg_bypass_offset = <0x00>;
-		// 	reg_bypass_shift = <9>;
-		// 	reg_pulse_start_offset = <0x00>;
-		// 	reg_pulse_start_shift = <8>;
-		// 	reg_mode_offset = <0x00>;
-		// 	reg_mode_shift = <7>;
-		// 	reg_polarity_offset = <0x00>;
-		// 	reg_polarity_shift = <5>;
-		// 	reg_period_offset = <0x04>;
-		// 	reg_period_shift = <16>;
-		// 	reg_period_width = <16>;
-		// 	reg_active_offset = <0x04>;
-		// 	reg_active_shift = <0>;
-		// 	reg_active_width = <16>;
-		// 	reg_prescal_offset = <0x00>;
-		// 	reg_prescal_shift = <0>;
-		// 	reg_prescal_width = <4>;
-		// };
-
-		// pwm1: pwm1@0300a000 {
-		// 	compatible = "allwinner,sunxi-pwm1";
-		// 	pinctrl-names = "default", "sleep";
-		// 	pinctrl-0 = <&pwm1_pins>;
-		// 	pinctrl-1 = <&pwm1_pins_gpio>;
-		// 	reg_base = <0x0300a000>;
-		// 	reg_busy_offset = <0x00>;
-		// 	reg_busy_shift = <29>;
-		// 	reg_enable_offset = <0x00>;
-		// 	reg_enable_shift = <19>;
-		// 	reg_clk_gating_offset = <0x00>;
-		// 	reg_clk_gating_shift = <21>;
-		// 	reg_bypass_offset = <0x00>;
-		// 	reg_bypass_shift = <24>;
-		// 	reg_pulse_start_offset = <0x00>;
-		// 	reg_pulse_start_shift = <23>;
-		// 	reg_mode_offset = <0x00>;
-		// 	reg_mode_shift = <22>;
-		// 	reg_polarity_offset = <0x00>;
-		// 	reg_polarity_shift = <20>;
-		// 	reg_period_offset = <0x08>;
-		// 	reg_period_shift = <16>;
-		// 	reg_period_width = <16>;
-		// 	reg_active_offset = <0x08>;
-		// 	reg_active_shift = <0>;
-		// 	reg_active_width = <16>;
-		// 	reg_prescal_offset = <0x00>;
-		// 	reg_prescal_shift = <15>;
-		// 	reg_prescal_width = <4>;
-		// };
-
-		// s_pwm: s_pwm@07020c00 {
-		// 	compatible = "allwinner,sunxi-s_pwm";
-		// 	reg = <0x07020c00 0x3c>;
-		// 	clocks = <&r_ccu CLK_R_APB1_PWM>;
-		// 	pwm-number = <1>;
-		// 	pwm-base = <0x10>;
-		// 	pwms = <&spwm0>;
-		// };
-
-		// spwm0: spwm0@07020c00 {
-		// 	compatible = "allwinner,sunxi-pwm16";
-		// 	pinctrl-0 = <&>;
-		// 	reg_base = <0x07020c00>;
-		// 	reg_busy_offset = <0x00>;
-		// 	reg_busy_shift = <28>;
-		// 	reg_enable_offset = <0x00>;
-		// 	reg_enable_shift = <4>;
-		// 	reg_clk_gating_offset = <0x00>;
-		// 	reg_clk_gating_shift = <6>;
-		// 	reg_bypass_offset = <0x00>;
-		// 	reg_bypass_shift = <9>;
-		// 	reg_pulse_start_offset = <0x00>;
-		// 	reg_pulse_start_shift = <8>;
-		// 	reg_mode_offset = <0x00>;
-		// 	reg_mode_shift = <7>;
-		// 	reg_polarity_offset = <0x00>;
-		// 	reg_polarity_shift = <5>;
-		// 	reg_period_offset = <0x04>;
-		// 	reg_period_shift = <16>;
-		// 	reg_period_width = <16>;
-		// 	reg_active_offset = <0x04>;
-		// 	reg_active_shift = <0>;
-		// 	reg_active_width = <16>;
-		// 	reg_prescal_offset = <0x00>;
-		// 	reg_prescal_shift = <0>;
-		// 	reg_prescal_width = <4>;
-		// };
-
 		ahub_daudio0:ahub_daudio0@0x05097000{
 			compatible = "allwinner,sunxi-ahub-daudio";
 			reg = <0x05097000 0xADF>;
-- 
2.17.1

